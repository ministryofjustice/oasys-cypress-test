import { Decimal } from 'decimal.js'
import * as dayjs from 'dayjs'

export type OgrsTestParameters = {
    dataFile: string,
    expectedResultsFile: string,
    outputFile: string,
    headers: boolean,
    dateFormat: string,
    tolerance: string,
    precision: number,
    reportMode: 'verbose' | 'normal' | 'minimal',
}

export type OgrsTestScriptResult = {
    testCaseResults: TestCaseResult[],
    failed: boolean,
}

export type TestCaseResult = {
    logText: string[],
    outputParams: OutputParameters,
    failed: boolean,
}

export type ScoreType = 'serious_violence_brief' | 'serious_violence_extended' | 'general_brief' | 'violence_brief' | 'general_extended' | 'violence_extended' | 'osp_c' | 'osp_i' | 'rsr'
export type ScoreBand = 'L' | 'M' | 'H' | 'V' | 'NA'

export type OgrsOffenceCat = { cat: string, addVatpFlag: boolean }

export type TestCaseParameters = {
    STATIC_CALC: string,
    DOB: dayjs.Dayjs,
    GENDER: string,
    OFFENCE_CODE: string,
    TOTAL_SANCTIONS_COUNT: number,
    TOTAL_VIOLENT_SANCTIONS: number,
    CONTACT_ADULT_SANCTIONS: number,
    CONTACT_CHILD_SANCTIONS: number,
    INDECENT_IMAGE_SANCTIONS: number,
    PARAPHILIA_SANCTIONS: number,
    STRANGER_VICTIM: string,
    AGE_AT_FIRST_SANCTION: number,
    LAST_SANCTION_DATE: dayjs.Dayjs,
    DATE_RECENT_SEXUAL_OFFENCE: dayjs.Dayjs,
    MOST_RECENT_OFFENCE: dayjs.Dayjs,
    COMMUNITY_DATE: dayjs.Dayjs,
    ONE_POINT_THIRTY: string,
    TWO_POINT_TWO: number,
    THREE_POINT_FOUR: number,
    FOUR_POINT_TWO: number,
    SIX_POINT_FOUR: number,
    SIX_POINT_SEVEN: number,
    SIX_POINT_EIGHT: number,
    SEVEN_POINT_TWO: number,
    DAILY_DRUG_USER: string,
    AMPHETAMINES: string,
    BENZODIAZIPINES: string,
    CANNABIS: string,
    CRACK_COCAINE: string,
    ECSTASY: string,
    HALLUCINOGENS: string,
    HEROIN: string,
    KETAMINE: string,
    METHADONE: string,
    MISUSED_PRESCRIBED: string,
    OTHER_DRUGS: string,
    OTHER_OPIATE: string,
    POWDER_COCAINE: string,
    SOLVENTS: string,
    SPICE: string,
    STEROIDS: string,
    EIGHT_POINT_EIGHT: number,
    NINE_POINT_ONE: number,
    NINE_POINT_TWO: number,
    ELEVEN_POINT_TWO: number,
    ELEVEN_POINT_FOUR: number,
    TWELVE_POINT_ONE: number,
    OGRS4G_ALGO_VERSION: number,
    OGRS4V_ALGO_VERSION: number,
    OGP2_ALGO_VERSION: number,
    OVP2_ALGO_VERSION: number,
    OSP_ALGO_VERSION: number,
    SNSV_ALGO_VERSION: number,
    AGGRAVATED_BURGLARY: number,
    ARSON: number,
    CRIMINAL_DAMAGE_LIFE: number,
    FIREARMS: number,
    GBH: number,
    HOMICIDE: number,
    KIDNAP: number,
    ROBBERY: number,
    WEAPONS_NOT_FIREARMS: number,
    CUSTODY_IND: string,
    age?: number,
    ageAtLastSanction?: number,
    ageAtLastSanctionSexual?: number,
    yearsBetweenFirstTwoSanctions?: number,
    ofm?: number,
    offenceCat?: OgrsOffenceCat,
    firstSanction?: boolean,
    secondSanction?: boolean,
    neverSanctionedViolence?: boolean,
    onceViolent?: boolean,
    male?: boolean,
    female?: boolean,
    out5Years?: boolean,
    offenceInLast5Years?: boolean,
    sexualOffenceInLast5Years?: boolean,
}


export type ScoreStatus = 'Y' | 'N' | 'E'

export type OutputParameters = {
    OGRS4G_CALCULATED: ScoreStatus,
    OGRS4G_YEAR_TWO: Decimal,
    OGRS4G_AAEAD: Decimal,
    OGRS4G_FEMALE: Decimal,
    OGRS4G_OFFENCE: Decimal,
    OGRS4G_FIRST_SANCTION: Decimal,
    OGRS4G_SECOND_SANCTION: Decimal,
    OGRS4G_TOTAL_SANCTIONS: Decimal,
    OGRS4G_SECOND_SANCTION_GAP: Decimal,
    OGRS4G_OFM: Decimal,
    OGRS4G_COPASG: Decimal,
    OGRS4G_COPASG_SQUARED: Decimal,
    OGRS4G_SCORE: Decimal,
    OGRS4G_PERCENTAGE: Decimal,
    OGRS4G_BAND: ScoreBand,
    OGRS4G_MISSING_QUESTIONS: string,
    OGRS4G_MISSING_COUNT: number,
    OGRS4V_CALCULATED: ScoreStatus,
    OGRS4V_YEAR_TWO: Decimal,
    OGRS4V_AAEAD: Decimal,
    OGRS4V_FEMALE: Decimal,
    OGRS4V_OFFENCE: Decimal,
    OGRS4V_FIRST_SANCTION: Decimal,
    OGRS4V_SECOND_SANCTION: Decimal,
    OGRS4V_TOTAL_SANCTIONS: Decimal,
    OGRS4V_SECOND_SANCTION_GAP: Decimal,
    OGRS4V_OFM: Decimal,
    OGRS4V_NEVER_VIOLENT: Decimal,
    OGRS4V_ONCE_VIOLENT: Decimal,
    OGRS4V_TOT_VIOLENT_SANCTIONS: Decimal,
    OGRS4V_COPAS_VIOLENT: Decimal,
    OGRS4V_SCORE: Decimal,
    OGRS4V_PERCENTAGE: Decimal,
    OGRS4V_BAND: ScoreBand,
    OGRS4V_MISSING_QUESTIONS: string,
    OGRS4V_MISSING_COUNT: number,
    SNSV_CALCULATED_STATIC: ScoreStatus,
    SNSV_YEAR_TWO_STATIC: Decimal,
    SNSV_AAEAD_STATIC: Decimal,
    SNSV_FEMALE_STATIC: Decimal,
    SNSV_OFFENCE_STATIC: Decimal,
    SNSV_FIRST_SANCTION_STATIC: Decimal,
    SNSV_SECOND_SANCTION_STATIC: Decimal,
    SNSV_TOTAL_SANCTIONS_STATIC: Decimal,
    SNSV_SECOND_SANC_GAP_STATIC: Decimal,
    SNSV_OFM_STATIC: Decimal,
    SNSV_COPASV_STATIC: Decimal,
    SNSV_NEVER_VIOLENT_STATIC: Decimal,
    SNSV_ONCE_VIOLENT_STATIC: Decimal,
    SNSV_TOT_VIOLENT_SANC_STATIC: Decimal,
    SNSV_COPAS_VIOLENT_STATIC: Decimal,
    SNSV_SCORE_STATIC: Decimal,
    SNSV_PERCENTAGE_YR2_STATIC: Decimal,
    SNSV_BAND_STATIC: ScoreBand,
    SNSV_MISSING_QUESTIONS_STATIC: Decimal,
    SNSV_MISSING_COUNT_STATIC: Decimal,
    OGP2_CALCULATED: ScoreStatus,
    OGP2_YEAR_TWO: Decimal,
    OGP2_AAEAD: Decimal,
    OGP2_FEMALE: Decimal,
    OGP2_OFFENCE: Decimal,
    OGP2_FIRST_SANCTION: Decimal,
    OGP2_SECOND_SANCTION: Decimal,
    OGP2_TOTAL_SANCTIONS: Decimal,
    OGP2_SECOND_SANCTION_GAP: Decimal,
    OGP2_OFM: Decimal,
    OGP2_COPASG: Decimal,
    OGP2_COPASG_SQUARED: Decimal,
    OGP2_SUITABLE_ACC: Decimal,
    OGP2_UNEMPLOYED: Decimal,
    OGP2_LIVE_IN_RELATIONSHIP: Decimal,
    OGP2_RELATIONSHIP: Decimal,
    OGP2_MULTIPLIC_RELATIONSHIP: Decimal,
    OGP2_DV: Decimal,
    OGP2_REGULAR_ACTIVITIES: Decimal,
    OGP2_DAILY_DRUG_USER: Decimal,
    OGP2_DRUG_MOTIVATION: Decimal,
    OGP2_CHRONIC_DRINKER: Decimal,
    OGP2_BINGE_DRINKER: Decimal,
    OGP2_IMPULSIVE: Decimal,
    OGP2_CRIMINAL_ATTITUDE: Decimal,
    OGP2_HEROIN: Decimal,
    OGP2_METHADONE: Decimal,
    OGP2_OTHER_OPIATE: Decimal,
    OGP2_CRACK: Decimal,
    OGP2_COCAINE: Decimal,
    OGP2_MISUSE_PRESCRIBED: Decimal,
    OGP2_BENZOS: Decimal,
    OGP2_AMPHETAMINES: Decimal,
    OGP2_ECSTASY: Decimal,
    OGP2_CANNABIS: Decimal,
    OGP2_STEROIDS: Decimal,
    OGP2_OTHER_DRUGS: Decimal,
    OGP2_TOTAL_SCORE_YR2: Decimal,
    OGP2_PERCENTAGE_YR2: Decimal,
    OGP2_BAND: ScoreBand,
    OGP2_MISSING_QUESTIONS: string,
    OGP2_MISSING_COUNT: number,
    OVP2_CALCULATED: ScoreStatus,
    OVP2_YEAR_TWO: Decimal,
    OVP2_AAEAD: Decimal,
    OVP2_FEMALE: Decimal,
    OVP2_OFFENCE: Decimal,
    OVP2_FIRST_SANCTION: Decimal,
    OVP2_SECOND_SANCTION: Decimal,
    OVP2_TOTAL_SANCTIONS: Decimal,
    OVP2_SECOND_SANCTION_GAP: Decimal,
    OVP2_OFM: Decimal,
    OVP2_COPASV: Decimal,
    OVP2_NEVER_VIOLENT: Decimal,
    OVP2_ONCE_VIOLENT: Decimal,
    OVP2_TOTAL_VIOLENT_SANCTIONS: Decimal,
    OVP2_COPAS_VIOLENT: Decimal,
    OVP2_SUITABLE_ACC: Decimal,
    OVP2_UNEMPLOYED: Decimal,
    OVP2_RELATIONSHIP: Decimal,
    OVP2_LIVE_IN_RELATIONSHIP: Decimal,
    OVP2_MULTIPLIC_RELATIONSHIP: Decimal,
    OVP2_DV: Decimal,
    OVP2_REGULAR_ACTIVITIES: Decimal,
    OVP2_DRUG_MOTIVATION: Decimal,
    OVP2_CHRONIC_DRINKER: Decimal,
    OVP2_BINGE_DRINKER: Decimal,
    OVP2_IMPULSIVE: Decimal,
    OVP2_TEMPER: Decimal,
    OVP2_CRIMINAL_ATTITUDE: Decimal,
    OVP2_HEROIN: Decimal,
    OVP2_CRACK: Decimal,
    OVP2_COCAINE: Decimal,
    OVP2_MISUSE_PRESCRIBED: Decimal,
    OVP2_BENZOS: Decimal,
    OVP2_AMPHETAMINES: Decimal,
    OVP2_ECSTASY: Decimal,
    OVP2_CANNABIS: Decimal,
    OVP2_STEROIDS: Decimal,
    OVP2_TOTAL_SCORE_YR2: Decimal,
    OVP2_PERCENTAGE_YR2: Decimal,
    OVP2_BAND: ScoreBand,
    OVP2_MISSING_QUESTIONS: string,
    OVP2_MISSING_COUNT: number,
    SNSV_CALCULATED_DYNAMIC: ScoreStatus,
    SNSV_YEAR_TWO_DYNAMIC: Decimal,
    SNSV_AAEAD_DYNAMIC: Decimal,
    SNSV_FEMALE_DYNAMIC: Decimal,
    SNSV_OFFENCE_DYNAMIC: Decimal,
    SNSV_FIRST_SANCTION_DYNAMIC: Decimal,
    SNSV_SECOND_SANCTION_DYNAMIC: Decimal,
    SNSV_TOTAL_SANCTIONS_DYNAMIC: Decimal,
    SNSV_SECOND_SANC_GAP_DYNAMIC: Decimal,
    SNSV_OFM_DYNAMIC: Decimal,
    SNSV_COPASV_DYNAMIC: Decimal,
    SNSV_NEVER_VIOLENT_DYNAMIC: Decimal,
    SNSV_ONCE_VIOLENT_DYNAMIC: Decimal,
    SNSV_TOT_VIOLENT_SANC_DYNAMIC: Decimal,
    SNSV_COPAS_VIOLENT_DYNAMIC: Decimal,
    SNSV_WEAPON_DYNAMIC: Decimal,
    SNSV_SUITABLE_ACC_DYNAMIC: Decimal,
    SNSV_UNEMPLOYED_DYNAMIC: Decimal,
    SNSV_RELATION_QUALITY_DYNAMIC: Decimal,
    SNSV_DV_DYNAMIC: Decimal,
    SNSV_CHRONIC_DRINKER_DYNAMIC: Decimal,
    SNSV_BINGE_DRINKER_DYNAMIC: Decimal,
    SNSV_IMPULSIVE_DYNAMIC: Decimal,
    SNSV_TEMPER_DYNAMIC: Decimal,
    SNSV_CRIM_ATTITUDE_DYNAMIC: Decimal,
    SNSV_HOMICIDE_DYNAMIC: Decimal,
    SNSV_GBH_DYNAMIC: Decimal,
    SNSV_KIDNAP_DYNAMIC: Decimal,
    SNSV_FIREARMS_DYNAMIC: Decimal,
    SNSV_ROBBERY_DYNAMIC: Decimal,
    SNSV_AGG_BURGLARY_DYNAMIC: Decimal,
    SNSV_WEAPONS_NOT_GUNS_DYNAMIC: Decimal,
    SNSV_CRIM_DAMAGE_LIFE_DYNAMIC: Decimal,
    SNSV_ARSON_DYNAMIC: Decimal,
    SNSV_SCORE_DYNAMIC: Decimal,
    SNSV_PERCENTAGE_DYNAMIC: Decimal,
    SNSV_BAND_DYNAMIC: ScoreBand,
    SNSV_MISSED_QUESTIONS_DYNAMIC: Decimal,
    SNSV_MISSING_COUNT_DYNAMIC: Decimal,
    OSP_DC_CALCULATED: ScoreStatus,
    OSP_DC_SCORE: Decimal,
    OSP_DC_PERCENTAGE: Decimal,
    OSP_DC_BAND: ScoreBand,
    OSP_DC_RISK_REDUCTION: Decimal,
    OSP_IIC_CALCULATED: ScoreStatus,
    OSP_IIC_PERCENTAGE: Decimal,
    OSP_IIC_BAND: ScoreBand,
    RSR_CALCULATED: ScoreStatus,
    RSR_DYNAMIC: String,
    RSR_PERCENTAGE: Decimal,
    RSR_BAND: ScoreBand,
    RSR_MISSING_QUESTIONS: string,
    RSR_MISSING_COUNT: number,
}

export type OgrsFeatures =
    'in_year_two_constant' |
    'aai_male' |
    'aai_quadratic_male' |
    'aai_cubic_male' |
    'aai_quartic_male' |
    'female' |
    'aai_female' |
    'aai_quadratic_female' |
    'aai_cubic_female' |
    'aai_quartic_female' |
    'absconding_bail' |
    'burglary_domestic' |
    'burglary_non_domestic' |
    'criminal_damage' |
    'drink_driving' |
    'drug_import_export_production' |
    'drug_possesion_supply' |
    'drunkenness' |
    'fraud_forgery' |
    'handling_stolen_goods' |
    'motoring_other_than_drink' |
    'other_offences' |
    'public_order_harassment' |
    'robbery' |
    'sexual_offences_children' |
    'sexual_offences_not_children' |
    'theft_handling_not_vehicle' |
    'index_abh_or_above' |
    'index_farmers_shotgun' |
    'index_firearms' |
    'index_weapons_not_firearm' |
    'vatp_flag' |
    'vehicle_related_theft' |
    'welfare_fraud' |
    'firstsanction' |
    'secondsanction' |
    'ogrs3_sanctionoccasions' |
    'yrs_between_first_and_second_sanction_male' |
    'yrs_between_first_and_second_sanction_female' |
    'ofm' |
    'ofm_quadratic' |
    'ofm_cubic' |
    'ofm_quartic' |
    'three_plus_sanction_copas_v_male' |
    'three_plus_sanction_copas_v_female' |
    'three_plus_sanction_copas_g_male' |
    'three_plus_sanction_copas_g_female' |
    'three_plus_sanction_copas_squared_male' |
    'three_plus_sanction_copas_squared_female' |
    'never_sanctioned_violent_male' |
    'never_sanctioned_violent_female' |
    'onceviolent' |
    'ogrs3_ovp_sanct' |
    'ogrs4v_rate_violent' |
    's2q2a_carry_use_weapon' |
    's3q2_lives_with_partner' |
    's3q4_suitability' |
    's4q2_unemployed' |
    's6q4_partner_relationship' |
    'quality_of_livein_relationship' |
    's6q7_perpetrator' |
    'dailydrug' |
    's8q8_motivation_tackle_misuse' |
    's9q1_current_use' |
    's9q2_binge_drinking' |
    's11q2_impulsivity' |
    's11q4_temper_control' |
    's12q1_procriminal_attitudes' |
    's7q2_activities_encourage' |
    'drug_current_use_heroin' |
    'drug_current_use_methadone' |
    'drug_current_use_otheropiate' |
    'drug_current_use_crack' |
    'drug_current_use_cokepowder' |
    'drug_current_use_prescribed' |
    'drug_current_use_benzo' |
    'drug_current_use_amphetamine' |
    'drug_current_use_ecstasy' |
    'drug_current_use_cannabis' |
    'drug_current_use_steroid' |
    'drug_current_use_anyotherdrug_new' |
    'r1q2_murder_prev' |
    'r1q2_wounding_prev' |
    'r1q2_kidnapping_prev' |
    'r1q2_firearm_prev' |
    'r1q2_robbery_prev' |
    'r1q2_agg_burglary_prev' |
    'r1q2_weapons_prev' |
    'r1q2_damage_with_intent_prev' |
    'r1q2_arson_prev'

export type OgrsCoefficients = { [keys in OgrsFeatures]?: Decimal }
