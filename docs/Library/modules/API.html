<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>API | Library</title><meta name="description" content="Documentation for Library"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><style>.container {
  padding: 0 2rem;
}

.tsd-page-toolbar {
  border: 0;
}

.container-main {
  padding: 4.8rem 0 0;
  height: 100vh;
  box-sizing: border-box;
  overflow: hidden;
}

.tsd-navigation.settings .tsd-accordion-details {
  padding: 1rem;
  background: var(--color-background-secondary);
}

.tsd-navigation.settings {
  display: inline-block;
  vertical-align: top;
}

.secondary.secondary {
  display: none;
}

.module.current .current .secondary.secondary {
  display: block;
}

.tsd-navigation.settings .tsd-index-accordion {
  position: relative;
}

.tsd-navigation.settings .tsd-accordion-summary {
  display: inline-flex;
  vertical-align: top;
  align-items: center;
  margin-left: 1rem;
}

.col-menu,
.col-content {
  position: static;
  margin: 0;
  height: 100%;
  box-sizing: border-box;
}

.col-menu {
  flex: 0 0 24rem;
  border-left: 0;
  padding-left: 1rem;
  padding-right: 0.1rem;
  background-color: lightgrey;
}

.tsd-toolbar-contents {
  background-color: lightsteelblue;
}

.col-content {
  padding-top: 1rem;
  padding-left: 1rem;
  padding-right: 1rem;
  overflow-x: hidden;
  flex: 1;
}

.menu-item-desc {
  color: #5d5d5d;
  font-size: 12px;
  line-height: 1.26;
  font-weight: normal;
}

:root[data-theme='dark'] .menu-item-desc {
  color: #989898;
}

@media (prefers-color-scheme: dark) {
  .menu-item-desc {
    color: #989898;
  }
}

a.tsd-index-link {
  align-items: flex-start;
  font-size: 0.9rem;
}

pre {
  border: 0;
}

.tsd-signature {
  background: var(--code-background);
  border: 0;
}

code.tsd-tag {
  border: 0;
}

#tsd-search.has-focus .tsd-navigation.settings {
  visibility: hidden;
}

.tsd-navigation.primary ul li li a {
  margin-left: 0.5rem;
  padding-top: 0.2rem;
  padding-bottom: 0.2rem;
}

.title {
  font-size: x-large;
}

.h1,
.h2 {
  font-size: large;
}

.tsd-breadcrumb,
.tsd-index-heading,
.tsd-sources {
  display: none;
}

.container {
  max-width: none;
}

.ts-kind-module {
  padding: 0;
  margin: 0
}

#tsd-sidebar-links {
  background-color:cornsilk;
  padding-top: 8px;
  padding-bottom: 8px;
  clear: both;
}

#tsd-sidebar-links a {
  display: inline;
  padding: 32px;
}

.ts-flagConst {
  display: none;
}

.tsd-hierarchy, .tsd-index-accordion {
  display: none;
}

.tsd-kind-icon, .tsd-parameters, .tsd-returns-title {
  display: none;
}

.tsd-kind-function {
  padding-top: 0;
}</style></head><body><script>console.log(`Loaded ${location.href}`);</script><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os"</script>
<div class="tsd-page-toolbar">
<div class="tsd-toolbar-contents container"><a href="../index.html" class="title">OASys Testing with Cypress</a></div>
<div id="tsd-sidebar-links" class="tsd-navigation"><a href="../../index.html">Introduction</a><a href="../../Tests/index.html">Writing and running tests</a><a href="../index.html">Library</a><a href="../../OffenderLib/index.html">Offenders</a><a href="../../Pages/index.html">Pages</a><a href="../../Users/index.html">Users</a><a href="../../Classes/index.html">Classes</a><a href="../../Types/index.html">Types</a></div></div>
<div class="container container-main">
<div class="col-menu menu-sticky-wrap menu-highlight">
<nav class="tsd-navigation primary">
<h2>Library</h2>
<div class="tsd-accordion-details">
<ul class="modules">
<li class="current module">
<ul>
<li class="current selected tsd-kind-module"><a href="API.html">
<div>API</div></a>
<nav class="tsd-navigation secondary menu-sticky">
<ul>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.checkAPIError.html" class="tsd-index-link">
<div>checkAPIError</div></a></li>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.checkAPIResponse.html" class="tsd-index-link">
<div>checkAPIResponse</div></a></li>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.getAPIResponse.html" class="tsd-index-link">
<div>getAPIResponse</div></a></li>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.getAPIResponses.html" class="tsd-index-link">
<div>getAPIResponses</div></a></li>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.testOneOffender.html" class="tsd-index-link">
<div>test<wbr/>One<wbr/>Offender</div></a></li></ul></nav></li>
<li class="tsd-kind-module"><a href="Assessment.html">
<div>Assessment</div></a>
<nav class="tsd-navigation secondary menu-sticky">
<ul>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.checkAPIError.html" class="tsd-index-link">
<div>checkAPIError</div></a></li>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.checkAPIResponse.html" class="tsd-index-link">
<div>checkAPIResponse</div></a></li>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.getAPIResponse.html" class="tsd-index-link">
<div>getAPIResponse</div></a></li>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.getAPIResponses.html" class="tsd-index-link">
<div>getAPIResponses</div></a></li>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.testOneOffender.html" class="tsd-index-link">
<div>test<wbr/>One<wbr/>Offender</div></a></li></ul></nav></li>
<li class="tsd-kind-module"><a href="Autodata.html">
<div>Autodata</div></a>
<nav class="tsd-navigation secondary menu-sticky">
<ul>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.checkAPIError.html" class="tsd-index-link">
<div>checkAPIError</div></a></li>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.checkAPIResponse.html" class="tsd-index-link">
<div>checkAPIResponse</div></a></li>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.getAPIResponse.html" class="tsd-index-link">
<div>getAPIResponse</div></a></li>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.getAPIResponses.html" class="tsd-index-link">
<div>getAPIResponses</div></a></li>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.testOneOffender.html" class="tsd-index-link">
<div>test<wbr/>One<wbr/>Offender</div></a></li></ul></nav></li>
<li class="tsd-kind-module"><a href="Database.html">
<div>Database</div></a>
<nav class="tsd-navigation secondary menu-sticky">
<ul>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.checkAPIError.html" class="tsd-index-link">
<div>checkAPIError</div></a></li>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.checkAPIResponse.html" class="tsd-index-link">
<div>checkAPIResponse</div></a></li>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.getAPIResponse.html" class="tsd-index-link">
<div>getAPIResponse</div></a></li>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.getAPIResponses.html" class="tsd-index-link">
<div>getAPIResponses</div></a></li>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.testOneOffender.html" class="tsd-index-link">
<div>test<wbr/>One<wbr/>Offender</div></a></li></ul></nav></li>
<li class="tsd-kind-module"><a href="Errors.html">
<div>Errors</div></a>
<nav class="tsd-navigation secondary menu-sticky">
<ul>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.checkAPIError.html" class="tsd-index-link">
<div>checkAPIError</div></a></li>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.checkAPIResponse.html" class="tsd-index-link">
<div>checkAPIResponse</div></a></li>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.getAPIResponse.html" class="tsd-index-link">
<div>getAPIResponse</div></a></li>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.getAPIResponses.html" class="tsd-index-link">
<div>getAPIResponses</div></a></li>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.testOneOffender.html" class="tsd-index-link">
<div>test<wbr/>One<wbr/>Offender</div></a></li></ul></nav></li>
<li class="tsd-kind-module"><a href="Navigation.html">
<div>Navigation</div></a>
<nav class="tsd-navigation secondary menu-sticky">
<ul>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.checkAPIError.html" class="tsd-index-link">
<div>checkAPIError</div></a></li>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.checkAPIResponse.html" class="tsd-index-link">
<div>checkAPIResponse</div></a></li>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.getAPIResponse.html" class="tsd-index-link">
<div>getAPIResponse</div></a></li>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.getAPIResponses.html" class="tsd-index-link">
<div>getAPIResponses</div></a></li>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.testOneOffender.html" class="tsd-index-link">
<div>test<wbr/>One<wbr/>Offender</div></a></li></ul></nav></li>
<li class="tsd-kind-module"><a href="Offender.html">
<div>Offender</div></a>
<nav class="tsd-navigation secondary menu-sticky">
<ul>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.checkAPIError.html" class="tsd-index-link">
<div>checkAPIError</div></a></li>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.checkAPIResponse.html" class="tsd-index-link">
<div>checkAPIResponse</div></a></li>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.getAPIResponse.html" class="tsd-index-link">
<div>getAPIResponse</div></a></li>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.getAPIResponses.html" class="tsd-index-link">
<div>getAPIResponses</div></a></li>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.testOneOffender.html" class="tsd-index-link">
<div>test<wbr/>One<wbr/>Offender</div></a></li></ul></nav></li>
<li class="tsd-kind-module"><a href="PDF_documents.html">
<div>PDF documents</div></a>
<nav class="tsd-navigation secondary menu-sticky">
<ul>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.checkAPIError.html" class="tsd-index-link">
<div>checkAPIError</div></a></li>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.checkAPIResponse.html" class="tsd-index-link">
<div>checkAPIResponse</div></a></li>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.getAPIResponse.html" class="tsd-index-link">
<div>getAPIResponse</div></a></li>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.getAPIResponses.html" class="tsd-index-link">
<div>getAPIResponses</div></a></li>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.testOneOffender.html" class="tsd-index-link">
<div>test<wbr/>One<wbr/>Offender</div></a></li></ul></nav></li>
<li class="tsd-kind-module"><a href="SAN_Assessments.html">
<div>SAN <wbr/>Assessments</div></a>
<nav class="tsd-navigation secondary menu-sticky">
<ul>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.checkAPIError.html" class="tsd-index-link">
<div>checkAPIError</div></a></li>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.checkAPIResponse.html" class="tsd-index-link">
<div>checkAPIResponse</div></a></li>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.getAPIResponse.html" class="tsd-index-link">
<div>getAPIResponse</div></a></li>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.getAPIResponses.html" class="tsd-index-link">
<div>getAPIResponses</div></a></li>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.testOneOffender.html" class="tsd-index-link">
<div>test<wbr/>One<wbr/>Offender</div></a></li></ul></nav></li>
<li class="tsd-kind-module"><a href="Task_utils.html">
<div>Task utils</div></a>
<nav class="tsd-navigation secondary menu-sticky">
<ul>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.checkAPIError.html" class="tsd-index-link">
<div>checkAPIError</div></a></li>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.checkAPIResponse.html" class="tsd-index-link">
<div>checkAPIResponse</div></a></li>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.getAPIResponse.html" class="tsd-index-link">
<div>getAPIResponse</div></a></li>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.getAPIResponses.html" class="tsd-index-link">
<div>getAPIResponses</div></a></li>
<li class="tsd-kind-function tsd-parent-kind-module"><a href="../functions/API.testOneOffender.html" class="tsd-index-link">
<div>test<wbr/>One<wbr/>Offender</div></a></li></ul></nav></li></ul></li></ul></div></nav></div>
<div class="col-content">
<div class="tsd-page-title">
<ul class="tsd-breadcrumb">
<li><a href="../modules.html">Library</a></li>
<li><a href="API.html">API</a></li></ul>
<h2>API</h2></div>
<section class="tsd-panel tsd-comment">
<div class="tsd-comment tsd-typography"><p><strong>oasys.Api.<em>function</em></strong>  </p>

<a href="#rest-api-testing" id="rest-api-testing" style="color: inherit; text-decoration: none;">
  <h3>Rest API testing</h3>
</a>
<p>The <code>oasys\tests\regression\restAPI</code> folder contains two tests which aim to carry out a comprehensive regression test on all endpoints.</p>

<a href="#oasystestsregressionrestapiendpointerrorscyts" id="oasystestsregressionrestapiendpointerrorscyts" style="color: inherit; text-decoration: none;">
  <h4><code>oasys\tests\regression\restAPI\endpointErrors.cy.ts</code></h4>
</a>
<p>This test calls each endpoint with parameters designed to generate an error condition, including:</p>
<ul>
<li>duplicate CRN</li>
<li>invalid CRN</li>
<li>invalid LAO parameter</li>
<li>access denied due to LAO status</li>
<li>no assessment found</li>
</ul>

<a href="#oasystestsregressionrestapitestallapismultipleoffenderscyts" id="oasystestsregressionrestapitestallapismultipleoffenderscyts" style="color: inherit; text-decoration: none;">
  <h4><code>oasys\tests\regression\restAPI\testAllApisMultipleOffenders.cy.ts</code></h4>
</a>
<p>This runs a regression test for all endpoints for a sample of offenders extracted from the database.  Offenders are selected on a partially random basis - 
there are 10 groups of offenders, each created prior to a random date in each of the last 10 years.  There is also another set of specific offenders that are known to have certain
data to ensure good test coverage.</p>
<p>For each selected offender, and each assessment for that offender, all necessary data is extracted from the database and used to build an expected response for each endpoint.
These expected responses are then compared against the actual responses, to identify missing properties, extra properties and incorrect values.</p>

<a href="#adding-new-apis" id="adding-new-apis" style="color: inherit; text-decoration: none;">
  <h3>Adding new APIs</h3>
</a>
<p>The following steps are required to add any new endpoints to the API tests:</p>
<ul>
<li>if any new data from the OASys database is required, update or add the appropriate class in <code>oasys\restAPI\dbClasses.ts</code>.  Each class here contains the relevant SQL query
as well as a constructor to create an object using the data returned by that query.  If new classes/queries are added, you will also have to update the code in
<code>cypress\support\restAPIdb.ts</code> that runs the queries.</li>
<li>add the new endpoint (assigning an appropriate name) to the <code>Endpoint</code> enum in <code>oasys\restAPI\callAPI.ts</code>.</li>
<li>use that name to add the url to the <code>restAPIUrls</code> const in <code>cypress\support\environments.ts</code>.</li>
<li>create a new class to define the expected endpoint response (details below).</li>
<li>add the new endpoint to the list of function calls in <code>getSingleResponse</code> in <code>oasys\restAPI\getExpectedResponses.ts</code>.</li>
<li>add the new endpoint to the appropriate list in <code>oasys\restAPI\testOneOffender.ts</code>.</li>
<li>add the new endpoint to the appropriate list in <code>oasys\tests\regression\restAPI\endpointErrors.cy.ts</code>.</li>
</ul>

<a href="#endpoint-classes" id="endpoint-classes" style="color: inherit; text-decoration: none;">
  <h4>Endpoint classes</h4>
</a>
<p>Expected responses are constructed using Typescript classes to define all the properties; there is a class for each endpoint in one of the folders under <code>oasys\restAPI</code>.
Common values (such as the assessment timeline and common assessment details) are added by the base classes, e.g. <code>oasys\restAPI\v4\v4Common.ts</code> which in turn inherits from 
<code>oasys\restAPI\common.ts</code>.</p>
<p>Each class file must be referenced in the <code>index.ts</code> file in the same folder, and must contain the items described below.  In general the best approach is to copy an existing class
file and modify it to fit the new specification; most new endpoints will be similar others in the <code>oasys\restAPI\v4</code> folder so one of these is likely to be a good starting point.</p>

<a href="#function-getexpectedresponseoffenderdata-dbclassesdboffenderwithassessments-parameters-apiendpointparams-resultalias-string" id="function-getexpectedresponseoffenderdata-dbclassesdboffenderwithassessments-parameters-apiendpointparams-resultalias-string" style="color: inherit; text-decoration: none;">
  <h4><code>function getExpectedResponse(offenderData: dbClasses.DbOffenderWithAssessments, parameters: api.EndpointParams, resultAlias: string)</code></h4>
</a>
<p>This function is called from <code>oasys\restAPI\getExpectedResponses.ts</code>, and returns the expected endpoint response using a Cypress alias. The required parameters are:</p>
<ul>
<li>a <code>DbOffenderWithAssessments</code> object, this will contain all necessary offender and assessment data</li>
<li>the endpoint parameters (e.g. endpoint name, CRN, assessment PK etc)</li>
</ul>
<p>It identifies the relevant assessment details, then creates a response object using classes like these examples:</p>

<a href="#class-roshsummendpointresponse-extends-v4commonv4endpointresponse" id="class-roshsummendpointresponse-extends-v4commonv4endpointresponse" style="color: inherit; text-decoration: none;">
  <h4><code>class RoshSummEndpointResponse extends v4Common.V4EndpointResponse</code></h4>
</a>

<a href="#roshsummassessment-extends-v4commonv4assessmentcommon" id="roshsummassessment-extends-v4commonv4assessmentcommon" style="color: inherit; text-decoration: none;">
  <h4><code>RoshSummAssessment extends v4Common.V4AssessmentCommon</code></h4>
</a>
<p>These, together with any other classes appropriate to each endpoint, contain property names that match the expected JSON property names, and are populated with the supplied 
offender and assessment data.</p>
</div></section><aside class="tsd-sources">
<ul>api.ts</ul></aside>
<section class="tsd-panel-group">
<section class="tsd-panel tsd-typography"></section></section>
<section class="tsd-panel-group tsd-index-group">
<section class="tsd-panel tsd-index-panel">
<h3 class="tsd-index-heading uppercase">Index</h3>
<section class="tsd-index-section">
<h3 class="tsd-index-heading">Functions</h3>
<div class="tsd-index-list"><a href="../functions/API.checkAPIError.html" class="tsd-index-link tsd-kind-function tsd-parent-kind-module"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><rect fill="var(--color-icon-background)" stroke="var(--color-ts-function)" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="6" id="icon-64-path"></rect><path d="M9.39 16V7.24H14.55V8.224H10.446V11.128H14.238V12.112H10.47V16H9.39Z" fill="var(--color-text)" id="icon-64-text"></path></svg><span>checkAPIError</span></a>
<a href="../functions/API.checkAPIResponse.html" class="tsd-index-link tsd-kind-function tsd-parent-kind-module"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-64-path"></use><use href="#icon-64-text"></use></svg><span>checkAPIResponse</span></a>
<a href="../functions/API.getAPIResponse.html" class="tsd-index-link tsd-kind-function tsd-parent-kind-module"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-64-path"></use><use href="#icon-64-text"></use></svg><span>getAPIResponse</span></a>
<a href="../functions/API.getAPIResponses.html" class="tsd-index-link tsd-kind-function tsd-parent-kind-module"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-64-path"></use><use href="#icon-64-text"></use></svg><span>getAPIResponses</span></a>
<a href="../functions/API.testOneOffender.html" class="tsd-index-link tsd-kind-function tsd-parent-kind-module"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-64-path"></use><use href="#icon-64-text"></use></svg><span>test<wbr/>One<wbr/>Offender</span></a>
</div></section></section></section></div></div>
<div class="overlay"></div><script src="../assets/main.js"></script></body></html>